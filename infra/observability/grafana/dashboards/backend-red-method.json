{
  "_header": {
    "purpose": "Backend RED method dashboard with per-endpoint Rate, Errors, and Duration breakdowns",
    "scope": "Per-endpoint HTTP metrics analysis with template variables for method and path filtering",
    "overview": "Implements the RED (Rate, Errors, Duration) method for backend API endpoint analysis. Provides per-endpoint breakdowns using Grafana template variables for HTTP method and path filtering. Includes request rate by path, error rate by path, duration histogram heatmap, and exemplar links to Tempo traces. Enables drill-down from aggregate Golden Signals to specific endpoint performance.",
    "dependencies": "Mimir datasource (uid: mimir), Tempo datasource (uid: tempo) for exemplar links, backend metrics.py instruments",
    "exports": "Provisioned Grafana dashboard accessible at /grafana/d/backend-red-method",
    "interfaces": "PromQL queries with template variables $method and $path for endpoint filtering",
    "environment": "Identical across dev/staging/prod",
    "related": "golden-signals-overview.json for aggregate view, trace-analysis.json for trace drill-down, metrics.py for metric definitions",
    "implementation": "Grafana dashboard JSON schema version 39 with template variables and exemplar-enabled queries"
  },
  "uid": "backend-red-method",
  "title": "Backend RED Method",
  "description": "Rate, Errors, Duration per endpoint with exemplar links",
  "tags": ["red-method", "backend", "per-endpoint"],
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 1,
  "editable": false,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "links": [
    {
      "title": "Home",
      "url": "/grafana/d/home",
      "type": "link",
      "icon": "external link"
    },
    {
      "title": "Golden Signals",
      "url": "/grafana/d/golden-signals-overview",
      "type": "link",
      "icon": "external link"
    }
  ],
  "templating": {
    "list": [
      {
        "name": "method",
        "label": "HTTP Method",
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "mimir" },
        "query": "label_values(http_requests_total, method)",
        "includeAll": true,
        "allValue": ".*",
        "multi": true,
        "refresh": 2,
        "sort": 1
      },
      {
        "name": "path",
        "label": "Path",
        "type": "query",
        "datasource": { "type": "prometheus", "uid": "mimir" },
        "query": "label_values(http_requests_total, path)",
        "includeAll": true,
        "allValue": ".*",
        "multi": true,
        "refresh": 2,
        "sort": 1
      }
    ]
  },
  "panels": [
    {
      "type": "row",
      "title": "Rate",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 1,
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "Request Rate by Path",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 1 },
      "id": 2,
      "datasource": { "type": "prometheus", "uid": "mimir" },
      "targets": [
        {
          "expr": "sum(rate(http_requests_total{method=~\"$method\", path=~\"$path\"}[$__rate_interval])) by (path)",
          "legendFormat": "{{path}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "fillOpacity": 10
          }
        },
        "overrides": []
      },
      "options": {
        "tooltip": { "mode": "multi", "sort": "desc" },
        "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "max"] }
      }
    },
    {
      "type": "timeseries",
      "title": "Request Rate by Method",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 1 },
      "id": 3,
      "datasource": { "type": "prometheus", "uid": "mimir" },
      "targets": [
        {
          "expr": "sum(rate(http_requests_total{method=~\"$method\", path=~\"$path\"}[$__rate_interval])) by (method)",
          "legendFormat": "{{method}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 50,
            "stacking": { "mode": "normal" }
          }
        },
        "overrides": []
      },
      "options": {
        "tooltip": { "mode": "multi", "sort": "desc" },
        "legend": { "displayMode": "list", "placement": "bottom" }
      }
    },
    {
      "type": "row",
      "title": "Errors",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 9 },
      "id": 4,
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "Error Rate % by Path",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 10 },
      "id": 5,
      "datasource": { "type": "prometheus", "uid": "mimir" },
      "targets": [
        {
          "expr": "sum(rate(http_errors_total{method=~\"$method\", path=~\"$path\"}[$__rate_interval])) by (path) / sum(rate(http_requests_total{method=~\"$method\", path=~\"$path\"}[$__rate_interval])) by (path) * 100",
          "legendFormat": "{{path}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "fillOpacity": 10
          },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 1 },
              { "color": "red", "value": 5 }
            ]
          }
        },
        "overrides": []
      },
      "options": {
        "tooltip": { "mode": "multi", "sort": "desc" },
        "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "max"] }
      }
    },
    {
      "type": "timeseries",
      "title": "Error Count by Status Code",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 10 },
      "id": 6,
      "datasource": { "type": "prometheus", "uid": "mimir" },
      "targets": [
        {
          "expr": "sum(rate(http_errors_total{method=~\"$method\", path=~\"$path\"}[$__rate_interval])) by (status_code)",
          "legendFormat": "{{status_code}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 50,
            "stacking": { "mode": "normal" }
          }
        },
        "overrides": []
      },
      "options": {
        "tooltip": { "mode": "multi", "sort": "desc" },
        "legend": { "displayMode": "list", "placement": "bottom" }
      }
    },
    {
      "type": "row",
      "title": "Duration",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 18 },
      "id": 7,
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "Duration p50/p95/p99 by Path",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 19 },
      "id": 8,
      "datasource": { "type": "prometheus", "uid": "mimir" },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(http_request_duration_seconds_bucket{method=~\"$method\", path=~\"$path\"}[$__rate_interval])) by (le, path))",
          "legendFormat": "p50 {{path}}",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{method=~\"$method\", path=~\"$path\"}[$__rate_interval])) by (le, path))",
          "legendFormat": "p95 {{path}}",
          "refId": "B"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(http_request_duration_seconds_bucket{method=~\"$method\", path=~\"$path\"}[$__rate_interval])) by (le, path))",
          "legendFormat": "p99 {{path}}",
          "refId": "C"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "fillOpacity": 10
          }
        },
        "overrides": []
      },
      "options": {
        "tooltip": { "mode": "multi", "sort": "desc" },
        "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "max"] }
      }
    },
    {
      "type": "heatmap",
      "title": "Request Duration Heatmap",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 19 },
      "id": 9,
      "datasource": { "type": "prometheus", "uid": "mimir" },
      "targets": [
        {
          "expr": "sum(increase(http_request_duration_seconds_bucket{method=~\"$method\", path=~\"$path\"}[$__rate_interval])) by (le)",
          "format": "heatmap",
          "legendFormat": "{{le}}",
          "refId": "A"
        }
      ],
      "options": {
        "calculate": false,
        "yAxis": { "unit": "s" },
        "color": { "scheme": "Oranges", "mode": "scheme" },
        "cellGap": 1,
        "tooltip": { "show": true }
      }
    },
    {
      "type": "timeseries",
      "title": "Request Duration with Exemplars",
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 27 },
      "id": 10,
      "datasource": { "type": "prometheus", "uid": "mimir" },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{method=~\"$method\", path=~\"$path\"}[$__rate_interval])) by (le))",
          "legendFormat": "p95",
          "refId": "A",
          "exemplar": true
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(http_request_duration_seconds_bucket{method=~\"$method\", path=~\"$path\"}[$__rate_interval])) by (le))",
          "legendFormat": "p99",
          "refId": "B",
          "exemplar": true
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "fillOpacity": 10,
            "showPoints": "auto"
          }
        },
        "overrides": []
      },
      "options": {
        "tooltip": { "mode": "multi", "sort": "desc" },
        "legend": { "displayMode": "table", "placement": "right", "calcs": ["mean", "max"] }
      }
    },
    {
      "type": "table",
      "title": "Top Endpoints by Request Count",
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 35 },
      "id": 11,
      "datasource": { "type": "prometheus", "uid": "mimir" },
      "targets": [
        {
          "expr": "topk(10, sum(increase(http_requests_total{method=~\"$method\", path=~\"$path\"}[$__range])) by (method, path))",
          "format": "table",
          "instant": true,
          "refId": "A"
        }
      ],
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": { "Time": true },
            "renameByName": {
              "method": "Method",
              "path": "Path",
              "Value": "Request Count"
            }
          }
        }
      ],
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "options": {
        "showHeader": true,
        "sortBy": [{ "displayName": "Request Count", "desc": true }]
      }
    }
  ],
  "time": { "from": "now-1h", "to": "now" },
  "refresh": "30s"
}
